name: Build Multi-Platform

on:
  workflow_dispatch

jobs:
  build-ios:
    runs-on: macos-26
    strategy:
      matrix:
        platform: [iOS]
    steps:
      - uses: actions/checkout@v5
      
      - name: Setup .NET 9
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: '9.0.x'
      
      - name: Install iOS workload
        run: dotnet workload install ios
      
      - name: Restore content dependencies
        working-directory: ./CBPlatformTest
        run: dotnet restore Content/Content.csproj

      - name: Restore iOS dependencies
        working-directory: ./CBPlatformTest
        run: dotnet restore CBPlatformTest.iOS/CBPlatformTest.iOS.csproj
      
      - name: Build iOS
        working-directory: ./CBPlatformTest
        run: dotnet build -c Release CBPlatformTest.iOS/CBPlatformTest.iOS.csproj
      
      - name: Archive iOS build
        run: |
          mkdir -p build-artifacts
          7z a -r build-artifacts/CBPlatformTest-iOS.zip CBPlatformTest/CBPlatformTest.iOS/bin/Release/
      
      - name: Upload iOS artifact
        uses: actions/upload-artifact@v4
        with:
          name: iOS-build-${{ matrix.platform }}
          path: build-artifacts/

  build-windows:
    runs-on: windows-latest
    strategy:
      matrix:
        platform: [DesktopGL, Android]
    steps:
      - uses: actions/checkout@v5
      
      - name: Setup .NET 9
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: '9.0.x'
      
      - name: Install Android workload
        run: dotnet workload install android
      
      - name: Restore content dependencies
        working-directory: ./CBPlatformTest
        run: dotnet restore Content/Content.csproj

      - name: Restore ${{ matrix.platform }} dependencies
        working-directory: ./CBPlatformTest
        run: dotnet restore CBPlatformTest.${{ matrix.platform }}/CBPlatformTest.${{ matrix.platform }}.csproj
      
      - name: Build ${{ matrix.platform }}
        working-directory: ./CBPlatformTest
        run: dotnet build -c Release CBPlatformTest.${{ matrix.platform }}/CBPlatformTest.${{ matrix.platform }}.csproj
      
      - name: Archive ${{ matrix.platform }} build
        run: |
          New-Item -ItemType Directory -Path build-artifacts -Force
          7z a -r build-artifacts/CBPlatformTest-${{ matrix.platform }}.zip CBPlatformTest/CBPlatformTest.${{ matrix.platform }}/bin/Release/
      
      - name: Upload ${{ matrix.platform }} artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.platform }}-build
          path: build-artifacts/
